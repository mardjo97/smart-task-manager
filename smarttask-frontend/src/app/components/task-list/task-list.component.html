<div class="container">
  <!-- Header -->
  <div class="header">
    <h1>SmartTask Manager</h1>
    <div class="user-info">
      <span>Welcome, {{ currentUser?.username }}</span>
      <button class="secondary" (click)="logout()">Logout</button>
    </div>
  </div>

  <!-- Task Form -->
  <div class="card" *ngIf="showForm">
    <h3>{{ editingTask ? 'Edit Task' : 'Create New Task' }}</h3>
    <form [formGroup]="taskForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="title">Title *</label>
        <input type="text" id="title" formControlName="title" placeholder="Enter task title" />
        <div class="error" *ngIf="taskForm.get('title')?.invalid && taskForm.get('title')?.touched">
          <span *ngIf="taskForm.get('title')?.errors?.['required']">Title is required</span>
          <span *ngIf="taskForm.get('title')?.errors?.['maxlength']">Title must not exceed 200 characters</span>
        </div>
      </div>

      <div class="form-group">
        <label for="description">Description</label>
        <textarea id="description" formControlName="description" rows="3" placeholder="Enter task description"></textarea>
        <div class="error" *ngIf="taskForm.get('description')?.invalid && taskForm.get('description')?.touched">
          <span *ngIf="taskForm.get('description')?.errors?.['maxlength']">Description must not exceed 1000 characters</span>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="dueDate">Due Date</label>
          <input type="date" id="dueDate" formControlName="dueDate" />
        </div>

        <div class="form-group">
          <label for="category">Category</label>
          <input type="text" id="category" formControlName="category" placeholder="Enter category" />
        </div>
      </div>

      <div class="form-group">
        <label>
          <input type="checkbox" formControlName="completed" />
          Mark as completed
        </label>
      </div>

      <div class="button-group">
        <button type="submit" class="primary" [disabled]="taskForm.invalid">
          {{ editingTask ? 'Update Task' : 'Create Task' }}
        </button>
        <button type="button" class="secondary" (click)="cancelForm()">Cancel</button>
      </div>
    </form>
  </div>

  <!-- Filters -->
  <div class="card">
    <div class="filter-section">
      <div>
        <button 
          [class.active]="filter === 'all'" 
          (click)="onFilterChange('all')"
          class="filter-btn">
          All Tasks ({{ tasks.length }})
        </button>
        <button 
          [class.active]="filter === 'pending'" 
          (click)="onFilterChange('pending')"
          class="filter-btn">
          Pending ({{ (tasks | filter: 'pending').length }})
        </button>
        <button 
          [class.active]="filter === 'completed'" 
          (click)="onFilterChange('completed')"
          class="filter-btn">
          Completed ({{ (tasks | filter: 'completed').length }})
        </button>
      </div>

      <div class="filter-controls">
        <select (change)="onCategoryFilterChange($event)" [value]="categoryFilter">
          <option value="">All Categories</option>
          <option *ngFor="let category of getUniqueCategories()" [value]="category">
            {{ category }}
          </option>
        </select>
        <button class="success" (click)="showCreateForm()" *ngIf="!showForm">+ New Task</button>
      </div>
    </div>
  </div>

  <!-- Task List -->
  <div *ngIf="loading" class="text-center">Loading tasks...</div>

  <div *ngIf="!loading && filteredTasks.length === 0" class="card text-center">
    <p>No tasks found. Create your first task!</p>
  </div>

  <div class="task-grid">
    <div class="task-card" *ngFor="let task of filteredTasks" [class.completed]="task.completed">
      <div class="task-header">
        <h3>{{ task.title }}</h3>
        <span class="category-badge" *ngIf="task.category">{{ task.category }}</span>
      </div>
      
      <p class="task-description" *ngIf="task.description">{{ task.description }}</p>
      
      <div class="task-meta">
        <span *ngIf="task.dueDate" class="due-date">
          ðŸ“… Due: {{ task.dueDate }}
        </span>
        <span [class]="task.completed ? 'status-completed' : 'status-pending'">
          {{ task.completed ? 'âœ“ Completed' : 'â—‹ Pending' }}
        </span>
      </div>

      <div class="task-actions">
        <button class="primary" (click)="toggleComplete(task)">
          {{ task.completed ? 'Mark Pending' : 'Mark Complete' }}
        </button>
        <button class="secondary" (click)="showEditForm(task)">Edit</button>
        <button class="danger" (click)="deleteTask(task)">Delete</button>
      </div>
    </div>
  </div>
</div>
